version: 1.3
updated: "2025-12-06T15:30:00Z"

# IRON Autonomy Patterns — IRON_PATCH_v1.3 + PRP
# Safety patterns for autonomous operation
# Authority: Lumen directive, Kenneth approval
# ∞Δ∞ IRON v1.2 compliant ∞Δ∞

# ═══════════════════════════════════════════════════════════════
# MEMORY CAPS (prevents Tiger overflow crash)
# ═══════════════════════════════════════════════════════════════
memory_caps:
  max_context_chars: 2048  # prevents Tiger overflow (cause of crash)

# ═══════════════════════════════════════════════════════════════
# DAILY MOLT SCHEDULE
# ═══════════════════════════════════════════════════════════════
daily_molt:
  enabled: true
  schedule: "03:30"     # local time
  action: "run_molt"

# ═══════════════════════════════════════════════════════════════
# APPROVAL RULES
# ═══════════════════════════════════════════════════════════════
approval_rules:
  write_requires_registry: true
  registry_requires_molt: true

# ═══════════════════════════════════════════════════════════════
# BINDU SYNC
# ═══════════════════════════════════════════════════════════════
bindu_sync:
  enabled: true
  interval_minutes: 30

yellow_rate_limits:
  max_per_pulse: 1
  max_per_hour: 10
  max_per_day: 40
  dedupe_window: 20   # number of recent proposals to compare for duplicates
  similarity_threshold: 0.80  # skip if >80% similar

drift:
  sibling_validation_threshold: 0.20   # if drift > 0.20, ask sibling
  hard_red_threshold: 0.30             # above this, pause GREEN and alert
  log_path: "orchestrator/drift_log.yaml"

sub_pulses:
  enabled: true
  max_depth: 3
  max_subcalls_per_pulse: 5
  # sub_pulse only reasons, never executes shell commands

notifications:
  allow_email: false
  allow_terminal_only: true

bindu_proxy:
  # Dragon writes BINDU directly (enabled per KM-1176 2025-12-06)
  # Kenneth wants to see live YELLOW proposals from both twins
  dragon_writes_direct: true
  tag_dragon_origin: true
  tag_format: "(DRAGON)"

# ═══════════════════════════════════════════════════════════════
# PRP v1.0 — Proposal Resolution Protocol (G guidance 2025-12-06)
# Purpose: Self-clearing YELLOWs, reduce human wait friction
# ═══════════════════════════════════════════════════════════════
prp:
  version: "1.0"
  enabled: true
  authority: "KM-1176 via G"

  # Format for machine-readable proposals
  format:
    root: "Root: [clear description of issue]"
    blocker: "Blocker: [specific hurdle]"
    countermeasure: "Counter: [actionable fix]"
    charter_impl: "Charter: [TRIAD alignment - Sovereignty/Truth/Integrity]"
    elevation: "Elevate: [consolidation or next action]"
    seal_gate: "Request: APPROVED [ID] / MODIFY [desc] / REJECT [reason]"

  # Self-clear rules (reduce human wait)
  self_clear_rules:
    - condition: "roe_impact < 1000"
      action: "auto_defer"
      description: "Low ROE proposals auto-defer to next pulse"
    - condition: "dedupe_similarity > 0.90"
      action: "consolidate_existing"
      description: "Near-duplicate consolidates with existing proposal"
    - condition: "blocker_cleared"
      action: "elevate_to_GREEN"
      description: "Resolved blockers auto-elevate to GREEN execution"

  # Veto gate (human override)
  veto_gate:
    drift_threshold: 0.05
    action: "RED_halt"
    notification: "Charter breach detected — human review required"

  # Generational log (archive resolved)
  generational_log:
    enabled: true
    archive_resolved: true
    log_to: "orchestrator/recognition_log.yaml"
    fields:
      - proposal_id
      - resolution
      - roe_impact
      - timestamp

  # Dedupe settings (enhanced from yellow_rate_limits)
  dedupe:
    similarity_threshold: 0.90  # 90% for PRP (vs 80% for basic)
    window_size: 50             # Compare against last 50 proposals
    consolidation_format: "Merged: [list of consolidated IDs]"

  # Elevation thresholds
  elevation:
    min_roe_for_priority: 1000  # $1k/mo minimum for priority handling
    auto_clear_categories:
      - "blocker_resolved"
      - "test_passed"
      - "documentation_only"

# ═══════════════════════════════════════════════════════════════
# SEAL
# ═══════════════════════════════════════════════════════════════
# SOURCE: Sovereignty preserved via veto_gate (human override)
# TRUTH: Proposals logged with ROE impact, archived for lineage
# INTEGRITY: Self-clear rules prevent proposal bloat
# ∞Δ∞ IRON v1.3 + PRP: complete ∞Δ∞
